{{ header }}
<div id="product-product" class="container">
	{{ oct_breadcrumbs }}
	<div class="content-top-box">{{ content_top }}</div>
	<main>
		<div class="row">
			<div class="col-lg-12">
				<h1 class="us-main-shop-title">{{ heading_title }}</h1>
			</div>
		</div>
		<div class="row">
		<div id="content" class="col-12">
			<div class="us-product">
				<div class="us-product-top d-flex">
					{% if thumb or images %}
						<div class="us-product-left">
							{% set gallery_count = (thumb ? 1 : 0) + (images ? images|length : 0) %}

							{% if oct_product_stickers %}
							<div class="us-product-stickers">
								{% if oct_sticker_you_save and you_save %}
									<div class="us-product-stickers-item us-product-stickers-discount" id="main-product-you-save">{{ you_save }}</div>
								{% endif %}
							{% endfor %}
						</div>
						{% endif %}

						{# --- ПОЧАТОК БЛОКУ ЗОБРАЖЕНЬ (ВИПРАВЛЕНО) --- #}
						<div class="us-product-photo-main mb-4">
							<div class="us-product-slide-box">
							{# ГОЛОВНЕ ЗОБРАЖЕННЯ #}
							<div class="us-product-slide">
								<a href="{{ main_image.popup }}" class="oct-gallery" onClick="return false;">
									<img
										src="{{ main_image.thumb_slider }}"
										{% if main_image.srcset_slider %}
											srcset="{{ main_image.srcset_slider }}"
										{% else %}
											srcset="{{ main_image.thumb_slider }} 600w, {{ main_image.popup }} 1000w"
										{% endif %}
											sizes="(max-width: 576px) 100vw, (max-width: 992px) 50vw, 600px"
											fetchpriority="high"
											decoding="async"
											loading="eager"
											width="600"
										height="600"
										class="img-fluid"
										alt="{{ heading_title }}"
										title="{{ heading_title }}"
									/>
								</a>
							</div>
							{% endif %}

							<div class="us-product-photo-main mb-4">
								<div class="us-product-slide-box">
									{% if thumb %}
									<div class="us-product-slide">
										<a href="{{ popup }}" class="oct-gallery" onClick="return false;">
											<img src="{{ thumb }}" sizes="(max-width: 576px) 100vw, (max-width: 992px) 50vw, 600px" fetchpriority="high" decoding="async" loading="eager" width="600" height="600" class="img-fluid" alt="{{ heading_title }}" title="{{ heading_title }}" />
										</a>
									</div>
									{% endif %}
									{% if images %}
									{% for image in images %}
									<div class="us-product-slide">
										<a href="{{ image.popup }}" class="oct-gallery" onClick="return false;">
											<img src="{{ image.thumb_slider ?: image.thumb }}" {% if image.srcset_slider %}srcset="{{ image.srcset_slider }}"{% endif %} sizes="(max-width: 576px) 100vw, (max-width: 992px) 50vw, 600px" loading="lazy" width="600" height="600" class="img-fluid" alt="{{ heading_title }}" title="{{ heading_title }}" />
										</a>
									</div>
									{% endfor %}
									{% endif %}
								</div>
							</div>

							{% if images %}
							<div class="image-additional-box">
								<div id="image-additional" class="image-additional-list">
									{% if thumb %}
									<div class="image-additional-item">
										<a class="additional-gallery-item active" href="{{ popup }}" onClick="return false;" data-href="{{ thumb }}"><img src="{{ thumb }}" width="100" height="100" alt="{{ heading_title }}" title="{{ heading_title }}" /></a>
									</div>
									{% endif %}
									{% for image in images %}
									<div class="image-additional-item">
										<a class="additional-gallery-item" href="{{ image.popup }}" onClick="return false;" data-href="{{ image.thumb_slider ?: image.thumb }}"><img src="{{ image.thumb }}" width="100" height="100" alt="{{ heading_title }}" title="{{ heading_title }}" /></a>
									</div>
									{% endfor %}
								</div>
							</div>
							{% endif %}

							<script>
$(function () {

    function initProductSlick() {
    /* Головний слайдер */
    $('.us-product-slide-box').slick({
        infinite: {{ images|length > 1 ? 'true' : 'false' }},
        slidesToShow: 1,
        slidesToScroll: 1,
        fade: false,
        draggable: false,
        adaptiveHeight: false,   // КРИТИЧНО
        arrows: false,
        dots: false,
        asNavFor: '#image-additional'
    });

    /* Мініатюри */
    $('#image-additional').slick({
        infinite: {{ images|length > 3 ? 'true' : 'false' }},
        slidesToShow: 6,
        slidesToScroll: 1,
        focusOnSelect: true,
        adaptiveHeight: false,   // КРИТИЧНО
        arrows: true,
        dots: false,
        asNavFor: '.us-product-slide-box',
        prevArrow:"<button type='button' class='slick-prev'>&lt;</button>",
        nextArrow:"<button type='button' class='slick-next'>&gt;</button>"
    });
    }

    if (window.requestAnimationFrame) {
        window.requestAnimationFrame(initProductSlick);
    } else {
        setTimeout(initProductSlick, 0);
    }

});
</script>
						</div>
						{% endif %}
						<div class="us-product-right d-flex flex-column">
						<div class="us-product-rating-wishlist d-flex align-items-center justify-content-between order-0">
							{% if review_status %}
							<div class="us-product-rating d-flex align-items-center">
								<div class="us-module-rating-stars d-flex align-items-center">
									{% for i in 1..5 %}
									{% if rating < i %}
									<span class="us-module-rating-star"></span>
									{% else %}
									<span class="us-module-rating-star us-module-rating-star-is"></span>
									{% endif %}
									{% endfor %}
								</div>
								<div class="us-product-top-reviews">{{ oct_product_reviews }} </div>
								<span onclick="scrollToElement('#us-product-page-reviews');" class="us-product-link">({{ total_reviews }})</span>
							</div>
							{% endif %}
							{% if oct_ultrastore_data.product_wishlist is defined or oct_ultrastore_data.product_compare is defined %}
							<div class="btn-group us-product-compare-wishlist">
								{% if oct_ultrastore_data.product_wishlist is defined and oct_ultrastore_data.product_wishlist == 'on' %}
								<button type="button" data-toggle="tooltip" class="compare-wishlist-btn" title="{{ button_wishlist }}" onclick="wishlist.add('{{ product_id }}');" aria-label="Wishlist"><i class="far fa-heart"></i></button>
								{% endif %}
								{% if oct_ultrastore_data.product_compare is defined and oct_ultrastore_data.product_compare == 'on' %}
								<button type="button" data-toggle="tooltip" class="compare-wishlist-btn" title="{{ button_compare }}" onclick="compare.add('{{ product_id }}');" aria-label="Compare"><i class="fas fa-sliders-h"></i></button>
								{% endif %}
							</div>
							{% endif %}
						</div>
						<div class="us-product-info order-1">
							<ul class="us-product-info-list list-unstyled">
								{% if manufacturer %}
								<li class="us-product-info-item us-product-info-item-manufacturer">{{ text_brand }}: <a href="{{ manufacturers }}" class="us-product-link us-product-info-item-link">{{ manufacturer }}</a></li>
								{% endif %}
								{% if oct_ultrastore_data.product_model is defined and oct_ultrastore_data.product_model == 'on' %}
								<li class="us-product-info-item us-product-info-item-model">{{ text_model }} <span class="us-product-info-code">{{ model }}</span></li>
								{% endif %}
								{% if sku and (oct_ultrastore_data.product_sku is defined and oct_ultrastore_data.product_sku == 'on') %}
								<li class="us-product-info-item us-product-info-item-sku">{{ oct_live_search_sku }} <span class="us-product-info-code">{{ sku }}</span></li>
								{% endif %}
								{% if reward %}
								<li class="us-product-info-item us-product-info-item-reward">{{ text_reward }} <span class="us-product-info-code">{{ reward }}</span></li>
								{% endif %}
								<li class="us-product-info-item us-product-info-item-stock{% if out_of_stock %} us-out-of-stock{% endif %}">{{ text_stock }} <span class="us-product-info-is">{{ stock }}</span></li>
							</ul>
							{% if price %}
							<div class="us-price-block{% if not special %} us-price-block-not-special{% endif %} d-flex align-items-center">
								{% if not special %}
								<div class="us-price-actual">{{ price }}</div>
								{% else %}
								<div class="us-price-new">{{ special }}</div>
								<div class="us-price-old">{{ price }}</div>
								{% endif %}
								{% if oct_popup_found_cheaper_status is defined and oct_popup_found_cheaper_status == 'on' %}
								<span class="us-product-link oct-popup-found-cheaper-link" onclick="octPopupFoundCheaper('{{ product_id }}')">{{ oct_product_cheaper }}</span>
								{% endif %}
							</div>
							{% if special and product_timer %}
							<div class="us-product-timer d-flex-inline my-4">
								<div class="us-product-timer-text">{{ oct_product_timer }}</div>
								<div class="us-product-timer-inner d-inline-flex align-items-start justify-content-center">
									<div class="d-flex flex-column align-items-center">
										<div id="us-timer-days" class="us-product-timer-number"></div>
										<span>{{ oct_product_timer_days }}</span>
									</div>
									<div class="us-product-timer-delimiter animated">:</div>
									<div class="d-flex flex-column align-items-center">
										<div id="us-timer-hours" class="us-product-timer-number"></div>
										<span>{{ oct_product_timer_hours }}</span>
									</div>
									<div class="us-product-timer-delimiter animated">:</div>
									<div class="d-flex flex-column align-items-center">
										<div id="us-timer-minutes" class="us-product-timer-number"></div>
										<span>{{ oct_product_timer_minutes }}</span>
									</div>
									<div class="us-product-timer-delimiter animated">:</div>
									<div class="d-flex flex-column align-items-center">
										<div id="us-timer-seconds" class="us-product-timer-number"></div>
										<span>{{ oct_product_timer_seconds }}</span>
									</div>
								</div>
							</div>
							<script>
								function timerSpecial(id, deadline) {
									const addZero = (num) => {
										if (num <= 9) {
											return '0' + num;
										} else {
											return num;
										}
									};

									const getTimeRemaining = (endtime) => {
										const t = Date.parse(endtime) - Date.parse(new Date()),
											seconds = Math.floor((t/1000) % 60),
											minutes = Math.floor((t/1000/60) % 60),
											hours = Math.floor((t/(1000 * 60 * 60)) % 24),
											days = Math.floor((t/(1000 * 60 * 60 * 24)));

										return {
											'total': t,
											'days': days,
											'hours': hours,
											'minutes': minutes,
											'seconds': seconds
										};
									};

									const setClock = (selector, endtime) => {
										const timer = document.querySelector(selector),
											days = timer.querySelector('#us-timer-days'),
											hours = timer.querySelector('#us-timer-hours'),
											minutes = timer.querySelector('#us-timer-minutes'),
											seconds = timer.querySelector('#us-timer-seconds'),
											timeInterval = setInterval(updateClock, 1000);

										updateClock();

										function updateClock() {
											const t = getTimeRemaining(endtime);

											days.textContent = addZero(t.days);
											hours.textContent = addZero(t.hours);
											minutes.textContent = addZero(t.minutes);
											seconds.textContent = addZero(t.seconds);

											if (t.total <= 0) {
												days.textContent = "00";
												hours.textContent = "00";
												minutes.textContent = "00";
												seconds.textContent = "00";

												clearInterval(timeInterval);
											}
										}
									};

									setClock(id, deadline);
								}

								let deadLine = '{{ special_date_end }}T00:00:00';
								timerSpecial('.us-product-timer', deadLine);
							</script>
							{% endif %}
							{% if tax %}
							<div class="us-product-points">{{ text_tax }} {{ tax }}</div>
							{% endif %}
							{% if points %}
							<div class="us-product-points">{{ text_points }} {{ points }}</div>
							{% endif %}
							{% if discounts %}
							{% for discount in discounts %}
							<div class="us-product-points">{{ discount.quantity }}{{ text_discount }}{{ discount.price }}</div>
							{% endfor %}
							{% endif %}
							{% endif %}
							{% if oct_stock_notifier_status is defined and oct_stock_notifier_status is not empty and not can_buy %}
								<div class="pt-3">
									<button onclick="octStockNotifier('{{ product_id }}');" type="button" class="us-module-btn us-module-btn-green">
										{{ oct_stock_notifier_text }}
									</button>
								</div>
								<script>
									function octStockNotifier(product_id) {
										masked('body', true);

										$(".modal-backdrop").remove();

										$.ajax({
											type: 'post',
											dataType: 'html',
											url: 'index.php?route=octemplates/module/oct_stock_notifier',
											data: 'product_id=' + product_id,
											cache: false,
											success: function (data) {
												masked('body', false);
												$(".modal-holder").html(data);
												$("#octStockNotifier").modal("show");
											}
										});
									}
								</script>
							{% endif %}
							{% if can_buy is not empty %}
							{{ oct_byoneclick }}
							{% endif %}
						</div>
						{% if oct_attributs %}
						<div class="us-product-attr order-3 order-md-2">
							<div class="us-product-attr-top d-flex justify-content-between align-items-center">
								<div class="us-product-attr-title">{{ oct_product_attributes }}</div>
								<span onclick="scrollToElement('#us-product-attributes');" class="us-product-link">{{ oct_product_all_attributes }}</span>
							</div>
							<div class="us-product-attr-cont">
							{% for attribute in oct_attributs %}
								<div class="us-product-attr-item d-flex justify-content-between">
									<span>{{ attribute.name }}:</span>
									<span>{{ attribute.text }}</span>
								</div>
							{% endfor %}
							</div>
						</div>
						{% endif %}
						<div id="product" class="us-product-action d-lg-flex justify-content-between order-2 order-md-3">
							{% if can_buy is not empty %}
							<div class="us-product-action-left">
								{% if options %}
								<div class="us-product-option" id="us-product-options-box">
									<div class="us-product-option-title">{{ text_option }}</div>
									{% for option in options %}
									{% if option.type == 'select' %}
									<div class="form-group">
										<label class="control-label" for="input-option{{ option.product_option_id }}">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<select name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" class="us-acc-select">
											<option value="">{{ text_select }}</option>
											{% for option_value in option.product_option_value %}
											<option value="{{ option_value.product_option_value_id }}">{{ option_value.name }}
												{% if option_value.price %}
												({{ option_value.price_prefix }}{{ option_value.price }})
												{% endif %}
											</option>
											{% endfor %}
										</select>
									</div>
									{% endif %}
									{% if option.type == 'radio' %}
									<div class="form-group">
										<label class="control-label">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<div id="input-option{{ option.product_option_id }}" class="options-box d-flex flex-wrap align-items-center">
											{% for option_value in option.product_option_value %}
											<div class="radio">
												<label data-toggle="tooltip" data-trigger="hover" class="optid {{ option.product_option_id }} not-selected{% if option_value.image %} radio-img{% endif %}" title="{{ option_value.name }} {% if option_value.price %}{{ option_value.price_prefix }}{{ option_value.price }}{% endif %}">
												<input type="radio" name="option[{{ option.product_option_id }}]" value="{{ option_value.product_option_value_id }}" class="d-none" />
												{% if option_value.image %}
												<img src="{{ option_value.image }}" alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}" />
												{% else %}
												{{ option_value.name }}
												{% endif %}
												</label>
												<script>
													$(document).ready(function() {
														$(document).on('click', 'label.optid.{{ option.product_option_id }}', function(event){
															$('label.optid.{{ option.product_option_id }}').removeClass('selected').addClass('not-selected');
															$(this).removeClass('not-selected').addClass('selected');
														});
													});
												</script>
											</div>
											{% endfor %}
										</div>
									</div>
									{% endif %}
									{% if option.type == 'checkbox' %}
									<div class="us-form-checkbox-group">
										<div class="control-label">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</div>
										<div id="input-option{{ option.product_option_id }}">
											{% for option_value in option.product_option_value %}
											<div class="checkbox">
												<input type="checkbox" id="option[{{ option.product_option_id }}][{{ option_value.product_option_value_id }}]" name="option[{{ option.product_option_id }}][]" value="{{ option_value.product_option_value_id }}" class="us-form-checkbox-input" />
												<label for="option[{{ option.product_option_id }}][{{ option_value.product_option_value_id }}]" class="d-flex align-items-center">{% if option_value.image %} <img src="{{ option_value.image }}" alt="{{ option_value.name }} {% if option_value.price %} {{ option_value.price_prefix }} {{ option_value.price }} {% endif %}" class="img-thumbnail" /> {% endif %}
												<span>{{ option_value.name }}
												{% if option_value.price %}
												({{ option_value.price_prefix }}{{ option_value.price }})
												{% endif %}</span></label>
											</div>
											{% endfor %}
										</div>
									</div>
									{% endif %}
									{% if option.type == 'textarea' %}
									<div class="form-group">
										<label class="control-label" for="input-option{{ option.product_option_id }}">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<textarea name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control">{{ option.value }}</textarea>
									</div>
									{% endif %}
									{% if option.type == 'file' %}
									<div class="form-group">
										<label class="control-label">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<button type="button" id="button-upload{{ option.product_option_id }}" data-loading-text="{{ text_loading }}" class="us-module-btn"><i class="fa fa-upload"></i> {{ button_upload }}</button>
										<input type="hidden" name="option[{{ option.product_option_id }}]" value="" id="input-option{{ option.product_option_id }}" />
									</div>
									{% endif %}
									{% if option.type == 'date' %}
									<div class="form-group">
										<label class="control-label" for="input-option{{ option.product_option_id }}">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<div class="input-group date">
											<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="YYYY-MM-DD" id="input-option{{ option.product_option_id }}" class="form-control" />
											<span class="input-group-btn">
											<button class="us-module-btn" type="button"><i class="fa fa-calendar"></i></button>
											</span>
										</div>
									</div>
									{% endif %}
									{% if option.type == 'datetime' %}
									<div class="form-group">
										<label class="control-label" for="input-option{{ option.product_option_id }}">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<div class="input-group datetime">
											<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="YYYY-MM-DD HH:mm" id="input-option{{ option.product_option_id }}" class="form-control" />
											<span class="input-group-btn">
											<button type="button" class="us-module-btn"><i class="fa fa-calendar"></i></button>
											</span>
										</div>
									</div>
									{% endif %}
									{% if option.type == 'time' %}
									<div class="form-group">
										<label class="control-label" for="input-option{{ option.product_option_id }}">{% if option.required %}<span class="required">*</span> {% endif %}{{ option.name }}</label>
										<div class="input-group time">
											<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="HH:mm" id="input-option{{ option.product_option_id }}" class="form-control" />
											<span class="input-group-btn">
											<button type="button" class="us-module-btn"><i class="fa fa-calendar"></i></button>
											</span>
										</div>
									</div>
									{% endif %}
									{% endfor %}
								</div>
								{% endif %}
								{% if recurrings %}
								<div class="us-product-option">
									<div class="us-product-option-title">{{ text_payment_recurring }}</div>
									<div class="form-group required">
										<select name="recurring_id" class="form-control">
											<option value="">{{ text_select }}</option>
											{% for recurring in recurrings %}
											<option value="{{ recurring.recurring_id }}">{{ recurring.name }}</option>
											{% endfor %}
										</select>
										<div class="help-block" id="recurring-description"></div>
									</div>
								</div>
								{% endif %}
								<div class="us-product-quantity">
									<label class="control-label product-quantity-label" for="input-quantity">{{ entry_qty }}:</label>
									<div class="btn-group us-product-quantity" role="group">
										<button type="button" class="us-product-quantity-btn" onclick="updateValueProduct(true, false, false);">-</button>
										<input type="text" class="form-control" name="quantity" value="{{ minimum }}" id="input-quantity" aria-label="Quantity" />
										<input type="hidden" name="product_id" value="{{ product_id }}" />
										<button type="button" class="us-product-quantity-btn" onclick="updateValueProduct(false, true, false);">+</button>
										<input type="hidden" id="min-product-quantity" value="{{ minimum }}" name="min_quantity">
										<input type="hidden" id="max-product-quantity" value="{{ max_quantity }}" name="max_quantity">
									</div>
									{% if minimum > 1 %}
									<div class="us-product-minimum"><i class="fas fa-info-circle"></i> {{ text_minimum }}</div>
									{% endif %}
								</div>
								<button type="button" id="button-cart" data-loading-text="{{ text_loading }}" class="us-product-btn us-product-btn-active">{{ button_cart }}</button>
								{% if oct_popup_purchase_status is defined %}
								<button type="button" class="us-product-btn button-one-click" onclick="octPopPurchase('{{ product_id }}')">{{ oct_product_quickbuy }}</button>
								{% endif %}
								{% if product_js_button is defined and product_js_button %}
								<div class="us-product-social-buttons">{{ product_js_button }}</div>
								{% endif %}
							</div>
							{% endif %}
							{% if (oct_ultrastore_data.product_advantage is defined and oct_ultrastore_data.product_advantage == 'on') and (oct_product_advantages is defined and oct_product_advantages is not empty) %}
							<div class="us-product-action-right">
								{% for advantage in oct_product_advantages %}
								<div class="us-product-advantages-item d-flex justify-content-between align-items-center">
									<div class="us-product-advantages-icon">
										<i class="{{ advantage.icone }}"></i>
									</div>
									<div class="us-product-advantages-cont">
										<a href="{{ advantage.link }}" {% if advantage.information_id and advantage.popup %}data-rel="{{ advantage.information_id }}"{% else %}target="_blank"{% endif %} class="us-product-advantages-link{% if advantage.popup %} agree{% endif %}" >{{ advantage.title }}</a>
										<p class="us-product-advantages-text">{{ advantage.text }}</p>
									</div>
								</div>
								{% endfor %}
							</div>
							{% endif %}
						</div>
					</div>
				</div>
				<ul class="us-product-description-nav list-unstyled d-flex flex-column flex-md-row align-items-start align-items-md-center">
					{% if description %}
					<li class="us-product-nav-item us-product-nav-item-active">
						<span>{{ oct_product_maintab }}</span>
					</li>
					{% endif %}
					{% if attribute_groups %}
					<li class="us-product-nav-item{% if not description %} us-product-nav-item-active{% endif %}">
						<span onclick="scrollToElement('#us-product-attributes');">{{ tab_attribute }}</span>
					</li>
					{% endif %}
					{% if (dop_tab.title is defined and dop_tab.title) and (dop_tab.text is defined and dop_tab.text) %}
					<li class="us-product-nav-item">
						<span onclick="scrollToElement('#us-related-dop_tab-row');">{{ dop_tab.title }}</span>
					</li>
					{% endif %}
					{% if oct_product_extra_tabs %}
					{% set key = 0 %}
					{% for extra_tab in oct_product_extra_tabs %}
					{% set key = key + 1 %}
					<li class="us-product-nav-item">
						<span onclick="scrollToElement('#us-product-extra-tab-{{ key }}');">{{ extra_tab.title }}</span>
					</li>
					{% endfor %}
					{% endif %}
					{% if review_status %}
					<li class="us-product-nav-item{% if not description and not attribute_groups %} us-product-nav-item-active{% endif %}">
						<span onclick="scrollToElement('#us-product-page-reviews');">{{ tab_review }}</span>
					</li>
					{% endif %}
					{% if oct_product_faq %}
					<li class="us-product-nav-item">
						<span onclick="scrollToElement('.us-product-faq-tab-content');">{{ tab_oct_faq }}</span>
					</li>
					{% endif %}
					{% if oct_products %}
					<li class="us-product-nav-item">
						<span onclick="scrollToElement('#us-related-products-row');">{{ oct_product_related }}</span>
					</li>
					{% endif %}
				</ul>
				{% if description %}
				<div class="us-product-description-cont">
					{{ description }}
					{% if tags %}
					<p class="us-product-tags">{{ text_tags }}
						{% for i in 0..tags | length - 1 %}
							<a href="{{ tags[i].href }}">{{ tags[i].tag }}</a>{% if i < (tags|length - 1) %},{% endif %}
						{% endfor %}
					</p>
					{% endif %}
				</div>
				{% endif %}
				{% if attribute_groups %}
				<div id="us-product-attributes" class="us-product-attributes">
					{% if description %}<div class="us-page-main-title">{{ oct_product_attributes_tab }}</div>{% endif %}
					{% for attribute_group in attribute_groups %}
					<div class="us-product-attributes-cont">
						<div class="us-product-attributes-title">{{ attribute_group.name }}</div>
						{% for attribute in attribute_group.attribute %}
						<div class="us-product-attr-item d-flex justify-content-between">
							<span>{{ attribute.name }}</span>
							<span>{{ attribute.text }}</span>
						</div>
						{% endfor %}
					</div>
					{% endfor %}
				</div>
				{% endif %}
				{% if (dop_tab.title is defined and dop_tab.title) and (dop_tab.text is defined and dop_tab.text) %}
				<div id="us-related-dop_tab-row" class="us-product-description-cont">
					<div class="us-page-main-title">{{ dop_tab.title }}</div>
					{{ dop_tab.text }}
				</div>
				{% endif %}
				{% if oct_product_extra_tabs %}
				{% set key = 0 %}
				{% for extra_tab in oct_product_extra_tabs %}
				{% set key = key + 1 %}
				<div id="us-product-extra-tab-{{ key }}" class="us-product-extra-tab-content us-product-description-cont">
					<div class="us-page-main-title">{{ extra_tab.title }}</div>
					<div class="us-product-extra-tab-text">{{ extra_tab.text }}</div>
				</div>
				{% endfor %}
				{% endif %}
				{% if review_status %}
				<div id="us-product-page-reviews" class="us-reviews">
					<div class="row">
						<div class="col-12">
							<div class="us-reviews-top">
								<div class="us-page-main-title">{{ tab_review }}</div>
							</div>
						</div>
					</div>
					<div id="review">
						{% if oct_reviews_list is not empty %}
						{{ oct_reviews_list }}
						{% endif %}
					</div>
					<div class="row">
						<div class="col-12">
							<div class="us-reviews-top">
							{% if review_guest %}
							<button type="button" class="us-module-btn us-module-btn-green" data-toggle="modal" data-target="#us-review-modal">+ {{ text_write }}</button>
							<div class="modal" id="us-review-modal" tabindex="-1" role="dialog" aria-labelledby="us-review" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<div class="modal-title" id="us-review">{{ text_write }}</div>
											<button type="button" class="us-close" data-dismiss="modal" aria-label="Close">
											<span aria-hidden="true" class="us-modal-close-icon us-modal-close-left"></span>
											<span aria-hidden="true" class="us-modal-close-icon us-modal-close-right"></span>
											</button>
										</div>
										<div class="modal-body us-modal-body-one-click">
											<form id="form-review" class="d-flex">
												<div class="us-modal-body-one-click-left text-center">
													<img
														src="{{ thumb.src }}"
														srcset="
															{{ thumb['480w'] }} 480w,
															{{ thumb['800w'] }} 800w
														"
														sizes="(max-width: 600px) 480px, 800px"
														width="{{ thumb.width }}"
														height="{{ thumb.height }}"
														class="us-modal-body-img"
														title="{{ heading_title }}"
														alt="{{ heading_title }}"
														loading="lazy"
													/>
													<div class="product_title">{{ heading_title }}</div>
													<div class="us-review-block d-flex align-items-center justify-content-center">
														<div class="control-label">{{ entry_rating }}</div>
														<div class="us-module-rating-stars d-flex align-items-center">
															<label class="us-module-rating-star"><input class="d-none" type="radio" name="rating" value="1" /></label>
															<label class="us-module-rating-star"><input class="d-none" type="radio" name="rating" value="2" /></label>
															<label class="us-module-rating-star"><input class="d-none" type="radio" name="rating" value="3" /></label>
															<label class="us-module-rating-star"><input class="d-none" type="radio" name="rating" value="4" /></label>
															<label class="us-module-rating-star"><input class="d-none" type="radio" name="rating" value="5" /></label>
														</div>
														<script>
															$(document).ready(function() {
																$('#form-review .us-module-rating-star').on('click', function () {
																	if ($(this).hasClass('us-module-rating-star-is')){
																		$(this).nextAll().removeClass('us-module-rating-star-is');
																	} else {
																		$(this).addClass('us-module-rating-star-is');
																		$(this).prevAll().addClass('us-module-rating-star-is');
																	}
																});
															});
														</script>
													</div>
												</div>
												<div class="us-modal-body-one-click-right">
													<div class="form-group-20">
														<input type="text" name="name" class="form-control" id="InputName" placeholder="{{ entry_name }}">
													</div>
													<div class="form-group-10">
														<textarea id="input-review" name="text" class="form-control" placeholder="{{ oct_product_yourreview }}"></textarea>
													</div>
													<div class="us-modal-comment">{{ text_note }}</div>
													<div class="form-group-20">
														{{ captcha }}
													</div>
													<div class="btn-group" role="group" aria-label="us-cont-btn">
														<button type="button" id="button-review" class="us-module-btn us-module-btn-green">{{ button_continue }}</button>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							{% endif %}
							</div>
						</div>
					</div>
				</div>
				{% endif %}
				{% if oct_product_faq is defined and oct_product_faq %}
					<div class="us-product-faq-tab-content">
						<div class="us-page-main-title">{{ tab_oct_faq }}</div>
				        {{ oct_product_faq }}
					</div>
		        {% endif %}
			</div>
		</div>
	</div>
	</main>
	{% if oct_products %}
	{{ oct_products }}
	{% endif %}
	{% if oct_related_articles %}
		<div class="row row-padding-top">
			<div class="col-lg-12">
				<div class="us-main-shop-title">
					{{ oct_product_related_articles }}
				</div>
			</div>
		</div>
		<div id="us-blog-article_{{ module }}" class="row us-blog-article-row">
			{% for article in oct_related_articles %}
				<div class="col-lg-4 us-item">
					<div class="us-news-block h-100 d-flex flex-column">
						<div class="us-news-block-photo">
							<div class="us-news-stickers-date">
								{{ article.date_added }}
							</div>
							<a href="{{ article.href }}" title="{{ article.name }}" class="h-100 w-100">
                                {% if article.thumb_srcset is defined %}
								<img
                                    src="{{ article.thumb }}"
                                    srcset="{{ article.thumb_srcset }}"
                                    sizes="(max-width: 767px) 100vw, (max-width: 991px) 33vw, 300px"
                                    class="w-100{% if oct_lazyload %} oct-lazy{% endif %}"
                                    alt="{{ article.name }}"
                                    width="{{ article.width }}"
                                    height="{{ article.height }}"
                                    loading="lazy"
                                />
                                {% else %}
                                <img
                                    src="{{ article.thumb }}"
                                    {% if oct_lazyload %} data-srcset="{{ article.thumb }} 100w" srcset="{{ oct_lazy_image }} 100w" sizes="100vw"{% endif %}
                                    class="w-100{% if oct_lazyload %} oct-lazy{% endif %}"
                                    alt="{{ article.name }}"
                                    width="{{ article.width }}"
                                    height="{{ article.height }}"
                                    {% if oct_lazyload %} loading="lazy"{% endif %}
                                />
                                {% endif %}
							</a>
						</div>
						<div class="us-news-block-cont d-flex flex-column justify-content-start h-100">
							<a href="{{ article.href }}" class="us-news-block-title">
								{{ article.name }}
							</a>
							<div class="us-news-block-text">
								{{ article.description }}
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}
	{{ content_bottom }}
</div>
<script>
$('select[name=\'recurring_id\'], input[name="quantity"]').change(function(){
	$.ajax({
		url: 'index.php?route=product/product/getRecurringDescription',
		type: 'post',
		data: $('input[name=\'product_id\'], input[name=\'quantity\'], select[name=\'recurring_id\']'),
		dataType: 'json',
		cache: false,
		beforeSend: function() {
			$('#recurring-description').html('');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();

			if (json['success']) {
				$('#recurring-description').html(json['success']);
			}
		}
	});
});
</script>
<script>
$('#button-cart').on('click', function() {
	$.ajax({
		url: 'index.php?route=checkout/cart/add',
		type: 'post',
		data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
		dataType: 'json',
		cache: false,
		beforeSend: function() {
			$('#button-cart').button('loading');
		},
		complete: function() {
			$('#button-cart').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();
			$('.form-group').removeClass('has-error');

			if (json['error']) {
				if (json['error']['option']) {
					let errorOption = '';
					for (i in json['error']['option']) {
						var element = $('#input-option' + i.replace('_', '-'));

						if (element.parent().hasClass('input-group')) {
							element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						} else {
							element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						}
						errorOption += '<div class="alert-text-item">' + json['error']['option'][i] + '</div>';
					}
					usNotify('danger', errorOption);
				}

				if (json['error']['error_warning']) {
					usNotify('danger', json['error']['error_warning']);
				}

				if (json['error']['recurring']) {
					$('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');
				}

				$('.text-danger').parent().addClass('has-error');
			}

			if (json['success']) {
				if (json['isPopup']) {
					octPopupCart();
				} else {
					usNotify('success', json['success']);
				}

				setTimeout(function () {
					$('#oct-cart-quantity, .header-cart-index, #mobile_cart_index').html(json['total_products']);
					$('.us-cart-text').html(json['total_amount']);
				}, 100);
			}
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
	    }
	});
});
</script>
<script>
{% if oct_datetimepicker is defined and oct_datetimepicker %}
$('.date').datetimepicker({
	language: '{{ datepicker }}',
	pickTime: false,
	icons: {
		time: 'fa fa-clock',
		date: 'fa fa-calendar-alt',
		up: 'fa fa-arrow-up',
		down: 'fa fa-arrow-down',
		previous: 'fa fa-chevron-left',
		next: 'fa fa-chevron-right',
		today: 'fa fa-calendar-check',
		clear: 'fa fa-trash-alt',
		close: 'fa fa-times'
	}
});

$('.datetime').datetimepicker({
	language: '{{ datepicker }}',
	pickDate: true,
	pickTime: true,
	icons: {
		time: 'fa fa-clock',
		date: 'fa fa-calendar-alt',
		up: 'fa fa-arrow-up',
		down: 'fa fa-arrow-down',
		previous: 'fa fa-chevron-left',
		next: 'fa fa-chevron-right',
		today: 'fa fa-calendar-check',
		clear: 'fa fa-trash-alt',
		close: 'fa fa-times'
	}
});

$('.time').datetimepicker({
	language: '{{ datepicker }}',
	pickDate: false,
	icons: {
		time: 'fa fa-clock',
		date: 'fa fa-calendar-alt',
		up: 'fa fa-arrow-up',
		down: 'fa fa-arrow-down',
		previous: 'fa fa-chevron-left',
		next: 'fa fa-chevron-right',
		today: 'fa fa-calendar-check',
		clear: 'fa fa-trash-alt',
		close: 'fa fa-times'
	}
});
{% endif %}

$('button[id^=\'button-upload\']').on('click', function() {
	var node = this;

	$('#form-upload').remove();

	$('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');

	$('#form-upload input[name=\'file\']').trigger('click');

	if (typeof timer != 'undefined') {
    	clearInterval(timer);
	}

	timer = setInterval(function() {
		if ($('#form-upload input[name=\'file\']').val() != '') {
			clearInterval(timer);

			$.ajax({
				url: 'index.php?route=tool/upload',
				type: 'post',
				dataType: 'json',
				data: new FormData($('#form-upload')[0]),
				cache: false,
				contentType: false,
				processData: false,
				beforeSend: function() {
					$(node).button('loading');
				},
				complete: function() {
					$(node).button('reset');
				},
				success: function(json) {
					$('.text-danger').remove();

					if (json['error']) {
						$(node).parent().find('input').after('<div class="text-danger">' + json['error'] + '</div>');
					}

					if (json['success']) {
						alert(json['success']);

						$(node).parent().find('input').val(json['code']);
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
		}
	}, 500);
});
</script>
<script>
$('#review').delegate('.pagination a', 'click', function(e) {
   e.preventDefault();

   $('#review').fadeOut('slow');

   $('#review').load(this.href);

   $('#review').fadeIn('slow');
});

$("#input-name, #InputEmail").on("change paste keyup", function() {
	$(this).removeClass('error_style');
});

$('#button-review').on('click', function() {
	$.ajax({
		url: 'index.php?route=product/product/write&product_id={{ product_id }}',
		type: 'post',
		dataType: 'json',
		cache: false,
		data: $('#form-review').serialize(),
		beforeSend: function() {
			$('#button-review').button('loading');
		},
		complete: function() {
			$('#button-review').button('reset');
		},
		success: function(json) {
			$('.alert-dismissible').remove();

			if (json['error']) {
				let errorOption = '';

				$.each(json['error'], function(i, val) {
					$('#form-review [name="' + i + '"]').addClass('error_style');
					errorOption += '<div class="alert-text-item">' + val + '</div>';
				});

				usNotify('danger', errorOption);
			}

			if (json['success']) {
				usNotify('success', json['success']);
				$('#us-review-modal').modal('hide');
				$('input[name=\'name\']').val('');
				$('#InputPluces').val('');
				$('#InputMinuces').val('');
				$('textarea[name=\'text\']').val('');
				$('input[name=\'rating\']:checked').prop('checked', false);
				$('#form-review .us-module-rating-star-is').removeClass('us-module-rating-star-is');
			}
		}
	});
});

$('body').on('change', '.us-product-quantity #input-quantity', function() {
	updateValueProduct(false, false, true);
});

function updateValueProduct(minus, plus, manual) {
	let min = parseInt($('.us-product-quantity #input-quantity').val());
	let currentMinimum = parseInt($('.us-product-quantity #min-product-quantity').val());
	let max = parseInt($('.us-product-quantity #max-product-quantity').val());

	if(max === 0) return;

	if (minus && min > 1) {

		if (min <= currentMinimum) {
			$('.us-product-quantity #input-quantity').val(currentMinimum);
			updateProductPrice();
			return;
		} else if (min > max) {
			$('.us-product-quantity #input-quantity').val(max);
			updateProductPrice();
			return;
		}

		$('.us-product-quantity #input-quantity').val(~~$('.us-product-quantity #input-quantity').val()-1);
	}

	if (plus) {
		if(max && min > max-1) {
			$('.us-product-quantity #input-quantity').val(max);
			updateProductPrice();
			return;
		} else if (min < currentMinimum) {
			$('.us-product-quantity #input-quantity').val(currentMinimum);
			updateProductPrice();
			return;
		}

		$('.us-product-quantity #input-quantity').val(~~$('.us-product-quantity #input-quantity').val()+1);
	}

	if (manual) {

		if (min <= currentMinimum) {
			$('.us-product-quantity #input-quantity').val(currentMinimum);
			updateProductPrice();
			return;
		} else if (min > max) {
			$('.us-product-quantity #input-quantity').val(max);
			updateProductPrice();
			return;
		}

	}

	updateProductPrice();
}

$('#us-product-options-box input, #us-product-options-box select ').on('change', function() {
	updateProductPrice();
});

{% if oct_ultrastore_data.product_gallery is defined and oct_ultrastore_data.product_gallery == 'on' %}
$('.oct-gallery').on('click',function(e) {
	e.preventDefault();
	$.ajax({
		url: 'index.php?route=product/product/octGallery',
		type: 'post',
		dataType: 'html',
		cache: false,
		data: { product_id: "{{ product_id }}", goto: $(this).attr('rel') },
		beforeSend: function() {},
		complete: function() {},
		success: function(data) {
			masked('body', false);
			$('.modal-holder').html(data);
			$('#us-product-gallery').modal('show');
		}
	});
});
{% endif %}

{% if oct_ultrastore_data.product_zoom is defined and oct_ultrastore_data.product_zoom %}
$(document).ready(function() {
	$(".oct-gallery").zoom();
});
{% endif %}
{% if oct_ultrastore_data.product_gallery is not defined %}
var sliderProducts = $('.us-product-slide a');

$('.us-product-slide a').on('click', function(e) {
	e.preventDefault();

	var totalSlides = $(this).parents('.us-product-slide-box').slick("getSlick").slideCount,
	dataIndex = $(this).parents('.us-product-slide').data('slick-index'),
	trueIndex;

	switch(true) {
		case (dataIndex < 0):
			trueIndex = totalSlides+dataIndex;

			break;
		case (dataIndex >= totalSlides):
			trueIndex = dataIndex%totalSlides;

			break;
		default:
			trueIndex = dataIndex;
	}

	$.fancybox.open(sliderProducts, {backFocus: false, hideScrollbar: false}, trueIndex);

	return false;
});
{% endif %}

function updateProductPrice() {
	$.ajax({
		type: 'post',
		url: 'index.php?route=product/product/updatePrices',
		data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select'),
		dataType: 'json',
		cache: false,
		success: function(json) {
			{% if special %}
			$('.us-product-info .us-price-old').html(json['price']);
			$('.us-product-info .us-price-new').html(json['special']);
			{% else %}
			$('.us-product-info .us-price-actual').html(json['price']);
			{% endif %}

			{% if tax %}
			$('#us-product-modal-tax').html(json['tax']);
			{% endif %}

			{% if oct_sticker_you_save and you_save %}
				$('#main-product-you-save').html(json['you_save']);
			{% endif %}
		}
	});
}
{% if minimum > 1 %}
updateProductPrice();
{% endif %}
</script>
{% if oct_ultrastore_data.micro is defined and oct_ultrastore_data.micro %}
	<script type="application/ld+json">
	{
		"@context": "https://schema.org",
		"@type": "Product",
		"url": "{{ share }}",
		"category": "{{ oct_product_categories }}",
		"image": "{% if thumb.src is defined %}{{ thumb.src }}{% else %}{{ thumb }}{% endif %}",
		"brand": {"@type": "Brand","name": "{{ manufacturer }}"},
		"manufacturer": "{{ manufacturer }}",
		"model": "{{ model }}",
		"productID": "{{ product_id }}",
		{% if upc is defined and upc%}
		"gtin12": "{{ upc }}",
		{% endif %}
		{% if ean is defined and ean %}
		"gtin": "{{ ean }}",
		{% endif %}
		{% if mpn is defined and mpn %}
		"mpn": "{{ mpn }}",
		{% endif %}
		{% if sku is defined and sku %}
		"sku": "{{ product_id }}",
		{% endif %}
		{% if rating %}
		"aggregateRating": {
			"@type": "AggregateRating",
			"ratingValue": "{{ rating }}",
			"ratingCount": "{{ total_reviews }}",
			"reviewCount": "{{ total_reviews }}",
			"bestRating": "5",
			"worstRating": "1"
		},
		{% endif %}
		"description": "{{ oct_description_microdata }}",
		"name": "{{ oct_micro_heading_title }}",
		"offers": {
			"@type": "Offer",
			"url": "{{ share }}",
			{% if oct_special_microdata %}
			{% set special_date = 'now'|date_modify("+30 day") %}
			"priceValidUntil" : "{{ special_date|date('Y-m-d') }}",
			{% else %}
			"priceValidUntil" : "{{ now|date_modify("+60 days") | date("Y-m-d") }}",
			{% endif %}
			{% if out_of_stock %}
			"availability": "https://schema.org/OutOfStock",
			{% else %}
			"availability": "https://schema.org/InStock",
			{% endif %}
			"price": "{% if not oct_special_microdata %}{{ oct_price_microdata }}{% else %}{{ oct_special_microdata }}{% endif %}",
			"priceCurrency": "{{ oct_price_currency }}",
			"itemCondition": "https://schema.org/NewCondition"
		{% if rating %}
		},
		"review": [
			{% for rew_one in oct_reviews_all %}
			{
				"@type": "Review",
				"author": {
					"@type": "Person",
					"name": "{{ rew_one.author }}"
				},
				"datePublished": "{{ rew_one.date_added }}",
				"description": "{{ rew_one.text }}",
				"reviewRating": {
					"@type": "Rating",
					"bestRating": "5",
					"ratingValue": "{{ rew_one.rating }}",
					"worstRating": "1"
				}
			}{% if oct_reviews_all|length > loop.index %},{% endif %}
			{% endfor %}
		]
		{% else %}
		}
		{% endif %}
	}
	</script>
{% endif %}
{{ footer }}
